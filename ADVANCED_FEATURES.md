# ุงูููุฒุงุช ุงููุชูุฏูุฉ ุงูุฌุฏูุฏุฉ - Advanced Features

## ุชุงุฑูุฎ ุงูุชุญุฏูุซ: 20 ุฃูุชูุจุฑ 2025

---

## ๐ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงููุชูุฏู (Advanced Notification System)

### ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

#### 1. **ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนุจุฑ SSE (Server-Sent Events)**
- ุงุชุตุงู ูุจุงุดุฑ ููุณุชูุฑ ุจูู ุงูุฎุงุฏู ูุงูุนููู
- ุชุณููู ุงูุฅุดุนุงุฑุงุช ูู ุงูููุช ุงููุนูู ุจุฏูู ุชุฃุฎูุฑ
- ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุงูุชููุงุฆู ุนูุฏ ุงููุทุงุน ุงูุงุชุตุงู

#### 2. **ูุธุงู ุฃููููุงุช ุฐูู**
- **ุนุงุฌู (Urgent)**: ุญุงู ุฏูุฑู ุงูุขู - ุตูุช ูุฒุฏูุฌ + ุงูุชุฒุงุฒ
- **ุนุงูู (High)**: ุงูุชุฑุจ ุฏูุฑู - ุตูุช ุจุณูุท
- **ุนุงุฏู (Normal)**: ุชุญุฏูุซุงุช ุนุงูุฉ
- **ููุฎูุถ (Low)**: ูุนูููุงุช ุฅุถุงููุฉ

#### 3. **ุชูุจุค ุฏููู ุจููุช ุงูุงูุชุธุงุฑ**
- ุญุณุงุจ ุชููุงุฆู ููููุช ุงููุชููุน ุจูุงุกู ุนูู:
  - ุนุฏุฏ ุงูููุชุธุฑูู ุฃูุงูู
  - ูุชูุณุท ููุช ุงูุฎุฏูุฉ ููู ุนูุงุฏุฉ
  - ูููุนู ุงูุญุงูู ูู ุงูุทุงุจูุฑ

#### 4. **ุฅุดุนุงุฑุงุช ูุชุนุฏุฏุฉ ุงููุณุชููุงุช**
- **ุงููููุน 1**: "๐ ุญุงู ุฏูุฑู ุงูุขู!" - ุชูุฌู ููุฑุงู
- **ุงููููุน 2**: "โฐ ุฃูุช ุงูุชุงูู!" - ูู ุฌุงูุฒุงู
- **ุงููููุน 3**: "โณ ุงูุชุฑุจ ุฏูุฑู ุฌุฏุงู" - ุงุจู ูุฑูุจุงู
- **ุงููููุน 4-5**: "โฐ ุงูุชุฑุจ ุฏูุฑู" - ุชูุฌู ูุญู ููุทูุฉ ุงูุงูุชุธุงุฑ
- **ุงููููุน 6-10**: ุชุญุฏูุซุงุช ุฏูุฑูุฉ
- **ุงููููุน 11+**: ุชุญุฏูุซุงุช ูู 5 ููุงูุน

#### 5. **ูุธุงู ุตูุชู ุจุณูุท**
- ูุบูุฉ "ุชูุท" ุจุณูุทุฉ ููุฅุดุนุงุฑุงุช
- ูุฏุฉ ุงููุบูุฉ ุชุนุชูุฏ ุนูู ุงูุฃููููุฉ
- ุจุฏูู ุชุนููุฏุงุช ุฃู ุฃุตูุงุช ูุฒุนุฌุฉ

### APIs ุงูุฌุฏูุฏุฉ:

#### 1. ุฅุฑุณุงู ุฅุดุนุงุฑ
```
POST /api/v1/notifications/send
Body: {
  "recipient_id": "user123",
  "recipient_type": "patient",
  "type": "your_turn",
  "title": "ุญุงู ุฏูุฑู",
  "message": "ุชูุฌู ููุนูุงุฏุฉ",
  "priority": "urgent",
  "channels": ["sse", "browser", "sound", "vibrate"]
}
```

#### 2. ุฌูุจ ุงูุฅุดุนุงุฑุงุช
```
GET /api/v1/notifications/get?recipient_type=patient&recipient_id=user123&limit=20
```

#### 3. ุชุญุฏูุฏ ูููุฑูุก
```
POST /api/v1/notifications/mark-read
Body: {
  "recipient_id": "user123",
  "mark_all": true
}
```

#### 4. ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ ููุทุงุจูุฑ
```
POST /api/v1/queue/auto-notify
Body: {
  "clinic": "internal"
}
```

#### 5. ุฅุดุนุงุฑุงุช ุฐููุฉ ูุน ุชูุจุค
```
POST /api/v1/notifications/smart-notify
Body: {
  "clinic": "internal",
  "user_id": "user123"  // ุงุฎุชูุงุฑู
}
```

#### 6. SSE ููุฅุดุนุงุฑุงุช ุงูููุฑูุฉ
```
GET /api/v1/events/notifications?recipient_type=patient&recipient_id=user123
```

---

## ๐บ๏ธ ูุธุงู ุงููุณุงุฑุงุช ุงูุฏููุงููููุฉ (Dynamic Path Routing)

### ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

#### 1. **ุญุณุงุจ ุงููุณุงุฑ ูุฑุฉ ูุงุญุฏุฉ ููุท**
- ูุชู ุญุณุงุจ ุงููุณุงุฑ ูู **ุจุฏุงูุฉ ุงููุญุต ููุท**
- ููุญูุธ ุงููุณุงุฑ (Sticky) ุทูุงู ุฑุญูุฉ ุงููุฑูุถ
- ูุง ูุชุบูุฑ ุงููุณุงุฑ ุจุนุฏ ุงูุญุณุงุจ ุงูุฃูู

#### 2. **ุชูุฒูุน ุฐูู ุญุณุจ ุงูุฃูุฒุงู**
- ุญุณุงุจ ุนุฏุฏ ุงูููุชุธุฑูู ูู ูู ุนูุงุฏุฉ
- ุฃูุฒุงู ุฃููููุฉ ููู ุนูุงุฏุฉ ุญุณุจ ููุน ุงููุญุต
- ูุชูุณุท ููุช ุงูุฎุฏูุฉ ููู ุนูุงุฏุฉ
- **ูุนุงุฏูุฉ ุงูุญุณุงุจ:**
  ```
  Score = (queue_length ร priority_weight ร avg_service_time) / 10
  ```
- ุงุฎุชูุงุฑ ุงููุณุงุฑ ุงูุฃูุซู (ุฃูู Score)

#### 3. **ููุงุนุฏ ุฅูุฒุงููุฉ**
- ุงููุฎุชุจุฑ (Lab) ุฏุงุฆูุงู ุฃููุงู (ุฅุฐุง ูุงู ูุทููุจุงู)
- ุงูุฃุดุนุฉ (X-ray) ุฏุงุฆูุงู ุซุงููุงู (ุฅุฐุง ูุงูุช ูุทููุจุฉ)
- ุจุงูู ุงูุนูุงุฏุงุช ุญุณุจ ุงูุฃูุฒุงู ุงูุฏููุงููููุฉ

#### 4. **ุฃููุงุน ุงููุญูุตุงุช ุงููุฏุนููุฉ**

##### ูุญุต ุงูุชุฌููุฏ (recruitment)
- ุงูุนูุงุฏุงุช: ุงููุฎุชุจุฑุ ุงูุฃุดุนุฉุ ุงูุนูููุ ุงูุจุงุทููุฉุ ุงูุฃูู ูุงูุฃุฐูุ ุงูุฌูุฏูุฉ
- ุฃูุฒุงู ุงูุฃููููุฉ ูุฎุตุตุฉ

##### ูุญุต ุฃุณุงุณู (basic)
- ุงูุนูุงุฏุงุช: ุงููุฎุชุจุฑุ ุงูุฃุดุนุฉุ ุงูุจุงุทููุฉ
- ูุณุงุฑ ูุฎุชุตุฑ

##### ูุญุต ุดุงูู (full)
- ุงูุนูุงุฏุงุช: ุฌููุน ุงูุนูุงุฏุงุช (8 ุนูุงุฏุงุช)
- ูุณุงุฑ ูุงูู

##### ูุญุต ูุณุงุก (women)
- ุงูุนูุงุฏุงุช: ุงููุฎุชุจุฑุ ุงูุฃุดุนุฉุ ุงูุจุงุทููุฉ ูุณุงุกุ ุงูุฌูุฏูุฉ ูุณุงุกุ ุงูุนููู ูุณุงุก
- ุจุฏูู PIN (no_pin: true)

##### ูุญุต ูุชุฎุตุต (specialized)
- ุงูุนูุงุฏุงุช: ุงููุฎุชุจุฑุ ุงูุฃุดุนุฉุ ุงูุจุงุทููุฉุ ุงูุนุธุงู
- ูุณุงุฑ ูุชุฎุตุต

### APIs ุงูุฌุฏูุฏุฉ:

#### 1. ุชุนููู ูุณุงุฑ ุฏููุงูููู
```
POST /api/v1/path/dynamic-assign
Body: {
  "user_id": "user123",
  "exam_type": "recruitment"
}

Response: {
  "success": true,
  "sticky": true,
  "session_code": "REC-user-abc123-xyz",
  "clinic_path": ["lab", "xray", "eyes", "internal", "ent", "derma"],
  "clinic_names": ["ุงููุฎุชุจุฑ", "ุงูุฃุดุนุฉ", "ุงูุนููู", "ุงูุจุงุทููุฉ", "ุงูุฃูู ูุงูุฃุฐู", "ุงูุฌูุฏูุฉ"],
  "weights_used": {
    "lab": 5,
    "xray": 3,
    "eyes": 8,
    "internal": 12,
    "ent": 6,
    "derma": 4
  },
  "total_estimated_time_minutes": 85,
  "total_estimated_time_text": "ุณุงุนุฉ ู 25 ุฏูููุฉ",
  "message": "ุชู ุญุณุงุจ ุงููุณุงุฑ ุงูุฃูุซู ุจูุฌุงุญ"
}
```

#### 2. ุชุญูููุงุช ุงููุณุงุฑุงุช
```
GET /api/v1/path/analytics?date=2025-10-20

Response: {
  "success": true,
  "statistics": {
    "total_paths_assigned": 45,
    "by_exam_type": {
      "recruitment": 30,
      "basic": 10,
      "full": 5
    },
    "avg_estimated_time": 75,
    "avg_clinics_per_path": 5.2,
    "unique_users_count": 45
  },
  "current_queue_weights": {
    "lab": 5,
    "xray": 3,
    ...
  }
}
```

#### 3. ุงุฎุชูุงุฑ ูุณุงุฑ (ูุณุฎุฉ ูุญุณูุฉ)
```
GET /api/v1/path/choose-v2?exam=recruitment&user=user123
```

---

## ๐ ุงูุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู

### 1. ุชุญุฏูุซุงุช ุนูู queue/enter.js
- ุฅุถุงูุฉ ุงุณุชุฏุนุงุก ุชููุงุฆู ูู `auto-notify` ุนูุฏ ุฏุฎูู ุทุงุจูุฑ ุฌุฏูุฏ
- ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ููุฑูุฉ ูุฌููุน ุงูููุชุธุฑูู

### 2. ูููู React ุฌุฏูุฏ
- `AdvancedNotificationPanel.jsx` - ููุญุฉ ุฅุดุนุงุฑุงุช ูุชูุฏูุฉ
- ุงุชุตุงู SSE ูุจุงุดุฑ
- ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูู ุงูููุช ุงููุนูู
- ุชุดุบูู ุงูุตูุช ุงูุจุณูุท ุชููุงุฆูุงู

### 3. ูููุงุช ูุณุงุนุฏุฉ
- `simple-beep.js` - ูุธุงู ุตูุชู ุจุณูุท
- ูุบูุฉ ูุงุญุฏุฉ ุจุณูุทุฉ "ุชูุท"
- ูุฏุฉ ูุชุบูุฑุฉ ุญุณุจ ุงูุฃููููุฉ

---

## ๐ฏ ุงูุงุณุชุฎุฏุงู ุงูููุตู ุจู

### ูููุฑุถู:
1. ุนูุฏ ุชุณุฌูู ุงูุฏุฎููุ ูุชู ุญุณุงุจ ุงููุณุงุฑ ุงูุฃูุซู ุชููุงุฆูุงู
2. ูุชููู ุงููุฑูุถ ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนู ูููุนู ูู ุงูุทุงุจูุฑ
3. ุชูุจููุงุช ุตูุชูุฉ ุจุณูุทุฉ ุนูุฏ ุงูุชุฑุงุจ ุงูุฏูุฑ
4. ูุนูููุงุช ุฏูููุฉ ุนู ุงูููุช ุงููุชููุน

### ููุฅุฏุงุฑุฉ:
1. ูุฑุงูุจุฉ ุชูุฒูุน ุงููุฑุถู ุนูู ุงูุนูุงุฏุงุช
2. ุชุญูููุงุช ููููุฉ ูููุณุงุฑุงุช
3. ุฅุญุตุงุฆูุงุช ุงูุฃูุฒุงู ุงูุญุงููุฉ
4. ุชูุงุฑูุฑ ุงูุฃุฏุงุก

---

## ๐ง ุงููููุงุช ุงูุฌุฏูุฏุฉ

### Backend (Functions):
- `/functions/api/v1/notifications/send.js`
- `/functions/api/v1/notifications/get.js`
- `/functions/api/v1/notifications/mark-read.js`
- `/functions/api/v1/events/notifications.js`
- `/functions/api/v1/queue/auto-notify.js`
- `/functions/api/v1/notifications/smart-notify.js`
- `/functions/api/v1/path/dynamic-assign.js`
- `/functions/api/v1/path/analytics.js`
- `/functions/api/v1/path/choose-v2.js`

### Frontend (React):
- `/src/components/AdvancedNotificationPanel.jsx`
- `/src/utils/simple-beep.js`

---

## โ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ูุธุงู ุงูุฅุดุนุงุฑุงุช:
```bash
# ุฅุฑุณุงู ุฅุดุนุงุฑ ุชุฌุฑูุจู
curl -X POST https://www.mmc-mms.com/api/v1/notifications/send \
  -H "Content-Type: application/json" \
  -d '{
    "recipient_id": "test123",
    "type": "your_turn",
    "title": "ุงุฎุชุจุงุฑ",
    "message": "ูุฐุง ุฅุดุนุงุฑ ุชุฌุฑูุจู",
    "priority": "urgent"
  }'

# ุฌูุจ ุงูุฅุดุนุงุฑุงุช
curl "https://www.mmc-mms.com/api/v1/notifications/get?recipient_type=patient&recipient_id=test123"
```

### ุงุฎุชุจุงุฑ ุงููุณุงุฑุงุช ุงูุฏููุงููููุฉ:
```bash
# ุชุนููู ูุณุงุฑ ุฌุฏูุฏ
curl -X POST https://www.mmc-mms.com/api/v1/path/dynamic-assign \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "test123",
    "exam_type": "recruitment"
  }'

# ุนุฑุถ ุงูุชุญูููุงุช
curl "https://www.mmc-mms.com/api/v1/path/analytics?date=2025-10-20"
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงููุธุงู ุงูุตูุชู**: ูุบูุฉ ุจุณูุทุฉ ููุทุ ุจุฏูู ุชุนููุฏุงุช
2. **ุงููุณุงุฑ ุงูุฏููุงูููู**: ููุญุณุจ ูุฑุฉ ูุงุญุฏุฉ ููุท ูู ุงูุจุฏุงูุฉ
3. **ุงูุฅุดุนุงุฑุงุช**: ููุฑูุฉ ุนุจุฑ SSEุ ุจุฏูู polling
4. **ุงูุฃูุฒุงู**: ุฏููุงููููุฉ ุญุณุจ ุงูููุช ุงููุนูู
5. **ุงูุชูุงูู**: ูุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู ุจุงููุงูู

---

## ๐ ุงูุฅุตุฏุงุฑ: v2.0 - Advanced Features
**ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ**: 20 ุฃูุชูุจุฑ 2025  
**ุงููุทูุฑ**: Manus AI  
**ุงูุญุงูุฉ**: ุฌุงูุฒ ูููุดุฑ โ

